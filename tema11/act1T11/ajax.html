<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="tema10.css">
</head>
<body onload="funcionAjax('', mostrarNombres)">
    <h2>Tarea 1 Tema 11</h2>
    
    <select id="seleccion">
    </select>
        <br>
        <br>
        <br>
        <div id="tabla"></div>
        
        <script> 
   
//    function funcionAjax(param, fun){
//     fetch('tema102.php?id='+param)
//     .then(result => result.json())
//     .then(result => fun(result))
//     .catch(e => console.log(`Error capturado: ${e}`));
//    }

function funcionAjax(param, fun){
    fetch('tema102.php?id='+param)
    .then(result => result.json())
    .then(funObj => fun(obj))
    .catch(e => console.log(`Error capturado: ${e}`));
   }

   
    async function funcionAjax(param, fun){
        try{
            const response = await fetch('tema102.php?id='+param);
            const obJson = await response.json();
                fun(obJson);
        }catch(error){
            console.log(error.message);
        }
    }
    
    
    function mostrarNombres(result){
        let selec = document.getElementById('seleccion');
        // let obj = JSON.parse(respuesta.responseText);
        let opcion;
        //el event.target.value, recoge el valor del elemento que provocÃ³ el evento. En este caso, option.value. 
        selec.addEventListener('change', function(event){funcionAjax(event.target.value,crearTabla)}); //selec.value;
        //Creamos la opciones select con los nombres de las personas      
        result.forEach(dato => {
            opcion = document.createElement('option');
            opcion.value = dato.id;
            opcion.text = dato.nombre;
            selec.appendChild(opcion); 
        });
      
    }
   
    function crearTabla(result){
   
    // let obj = JSON.parse(respuesta.responseText);
    let tabla = document.createElement('table');
    tabla.setAttribute("class","nuevaTabla");

         let filaID = '<tr><th>ID</th><td>' + result[0].id + ' </td></tr>';
         let filaNombre = '<tr><th>Nombre</th><td>' + result[0].nombre + '</td></tr>';
         let filaApellido = '<tr><th>Apellidos</th><td>' + result[0].apellidos + '</td></tr>';
         let filaCiudad = '<tr><th>Ciudad</th><td>' + result[0].ciudad + '</td></tr>'; 
    
         tabla.innerHTML = `<tbody>${filaID} ${filaNombre}${filaApellido}${filaCiudad}</tbody>`;
        
         let divTabla = document.getElementById('tabla');
         divTabla.innerHTML = "";
         divTabla.appendChild(tabla);
         
    };
    
    </script>
    
  
</body>
</html>